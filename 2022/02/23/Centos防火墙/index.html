<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="shiwi"><meta name="copyright" content="SHIWIVI"><link rel="preconnect" href="https://cdn.jsdelivr.net/"><link rel="shortcut icon" href="/blog/images/favicon.ico" type="image/x-icon"><style>.preload{position:absolute;display:flex;flex-direction:column;align-items:center;justify-content:center;left:0;top:0;width:100%;height:100%;background-color:#000;z-index:100}.text{margin-bottom:10px;color:#00cff3;text-shadow:0 0 3px #00cff3;font-size:20px}.text span{display:inline-block}.dance{animation:dance .8s linear}.text span:nth-child(1){animation-delay:0s}.text span:nth-child(2){animation-delay:.1s}.text span:nth-child(3){animation-delay:.2s}.text span:nth-child(4){animation-delay:.3s}.text span:nth-child(5){animation-delay:.4s}.text span:nth-child(6){animation-delay:.5s}.text span:nth-child(7){animation-delay:.6s}.text span:nth-child(8){animation-delay:.7s}.text span:nth-child(9){animation-delay:.8s}.text span:nth-child(10){animation-delay:.9s}@keyframes dance{0%{transform:translateY(0)}50%{transform:translateY(-20px)}100%{transform:translateY(0)}}.loading{width:80%;max-width:260px;height:6px;background-color:#e1e4e8;border-radius:6px}.bar{display:flex;height:100%;background:linear-gradient(90deg,#ffd33d,#ea4aaa 10%,#b34bff 30%,#01feff 51%,#ffb33d 68%,#ea4aaa 85%,#b34bff);background-size:300% 100%;animation:bar 2s linear infinite}@keyframes bar{0%{background-position:100%}100%{background-position:0}}</style><body><div class="preload"><div class="text"><span>L</span> <span>o</span> <span>a</span> <span>d</span> <span>i</span> <span>n</span> <span>g</span> <span>.</span> <span>.</span> <span>.</span></div><div class="loading"><span class="bar"></span></div></div><script>let texts=document.querySelector('.text').querySelectorAll('span');let timer=setInterval(()=>{texts.forEach((item)=>{item.classList.toggle("dance")})},1700);window.onload=function(){clearInterval(timer);document.querySelector('.preload').style="display:none;"}</script><title>SHIWIVI-文章</title>
<link rel="stylesheet" href="https://at.alicdn.com/t/font_2856826_bu73u0ahu7a.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.css">

<link rel="stylesheet" href="/blog/css/index.css">
<link rel="stylesheet" href="/blog/css/article.css">
<link rel="stylesheet" href="/blog/css/atelier-cave.min.css">

<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/blog/atom.xml" title="SHWIVI's blog" type="application/atom+xml">
</head>
<body>
<div class="nav">
    <div class="card">
        <div class="head">
            <img src="/blog/images/head.jpg"  alt="头不见了.." title="狗">
        </div>
        <div class="cardText">
            <p>(ー`´ー)</p>
            <p>那不是bug，是彩蛋</p>
        </div> 
    </div>
    <ul class="label">
        
        <li><a href="/blog/index.html">首页</a></li>
        
        <li><a href="/blog/life">日常</a></li>
        
        <li><a href="/blog/record">一句</a></li>
        
        <li><a href="/blog/message">留言</a></li>
        
        <li><a href="/blog/about">关于</a></li>
          
    </ul>
        <ul class="tag">
            <li>#Document</li>
            <li>#Java</li>
            <li>#css</li>
            <li>#Life</li>
            <li>#Lua</li>
            <li>#PCB</li>
            <li>#Shell</li>
            <li>#C</li>
            <li>#html</li>
            <li>#硬件</li>
            <li>#javaScript</li>
            <li>#Firewall</li>
            <li>#Security</li>
            <li><a href="/blog/tags/Linux" target="_blank">#Linux</a></li>
            <li>#Python</li>
            <li>#Serve</li>
            <li>#Web</li>
        </ul>
    <div class="rsstag"><a href="/blog/atom.xml"><span class="iconfont icon-rss"></span>RSS订阅</a></div>
<div class="flower">
<?xml version="1.0" encoding="UTF-8"?>
<svg width="84.6px" height="70.5px" viewBox="0 0 254 212" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<title>窗</title>
<desc>Created with Sketch.</desc>
<defs></defs>
<g id="植物" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
    <g id="Artboard" transform="translate(-885.000000, -503.000000)">
        <g id="植物-紫色盆" transform="translate(882.000000, 500.000000)">
            <ellipse id="Oval-12" fill="#B3B7C7" cx="140.5" cy="137" rx="39.5" ry="6"></ellipse>
            <g id="Group-5">
                <path d="M131.5,149 C137.746054,149 138.400559,136.953074 140.297813,118.503702 C141.504079,106.77367 149.145158,88.1140929 147,75 C142.297813,46.2539062 153.271934,32.5660626 150.170125,19.4282488 C148.031314,10.3692495 142.862042,3 131.5,3 C123.603887,3 113.698654,6.59314895 110.722909,11.2157433 C103.206874,22.8913341 114,46.5137576 114,75 C114,90.4435309 122.495151,106.751425 123.699377,118.476362 C125.595832,136.941172 125.250862,149 131.5,149 Z" id="Oval-11" fill="#BAC4F6"></path>
                <path d="M135.5,146.5 C132.598908,121.877878 130.965369,104.566553 130.599381,94.5660242 C130.050399,79.5652312 132.963841,77.0580598 132.164069,55.3464601 C131.630888,40.8720602 130.242865,30.4232402 128,24" id="Line-15" stroke="#FFFFFF" stroke-width="2" opacity="0.800892857" stroke-linecap="square"></path>
                <path d="M77.0442201,163.336077 C84.2239219,163.336077 101.067658,131.237823 101.067658,92.025606 C101.067658,52.8133888 90.9057581,-2.32627732 72.6560979,17.2440872 C50.0508064,41.4852946 69.5871262,36.5862429 74.0442201,63.8595149 C75.572858,73.2133576 77.0442201,94.5993942 77.0442201,104.613421 C77.0442201,143.825638 69.8645184,163.336077 77.0442201,163.336077 Z" id="Oval-9" fill="#BAC4F6" transform="translate(81.510722, 88.251316) rotate(-43.000000) translate(-81.510722, -88.251316) "></path>
                <path d="M42.5,50.5 C47.5132933,48.8699207 59.3816332,57.6317857 78.1050199,76.785595 C96.8284065,95.9394043 113.960067,116.844206 129.5,139.5" id="Line-17" stroke="#FFFFFF" stroke-width="2" stroke-linecap="square"></path>
                <path d="M155.281006,152.144255 C162.116643,152.144255 178.153197,121.584207 178.153197,84.2511084 C178.153197,72.6051871 184.354199,51.8242671 182.531201,39.8465879 C178.51025,13.4276595 163.058175,0.233079666 151.10317,13.0532528 C129.581164,36.1327785 143.297279,29.7382802 147.540781,55.7045685 C148.996164,64.6101585 153.500382,80.3852665 153.500382,89.9194035 C153.500382,127.252502 148.445368,152.144255 155.281006,152.144255 Z" id="Oval-9-Copy-2" fill="#E9EDFD" transform="translate(161.092971, 80.123972) scale(-1, 1) rotate(-20.000000) translate(-161.092971, -80.123972) "></path>
                <path d="M180.5,34.5 C181.290102,21.4892162 175.746138,28.9223292 163.868108,56.7993391 C157.546037,71.6368512 150.532373,85.3308057 144.827114,101.881203 C141.023608,112.914801 138.581237,128.787733 137.5,149.5" id="Line-20" stroke="#FFFFFF" stroke-width="2" stroke-linecap="square"></path>
                <path d="M60.3426107,183.894782 C69.2498271,183.894782 90.1463498,156.072081 90.1463498,122.083011 C90.1463498,88.0939419 67.5408019,29.4364067 54.8986583,57.2625442 C45.0326912,78.978146 51.0912584,74.0282851 56.6207779,97.6687014 C58.5172227,105.776593 67.8616068,124.363423 67.8616068,133.043561 C67.8616068,167.032631 51.4353942,183.894782 60.3426107,183.894782 Z" id="Oval-9-Copy" fill="#BAC4F6" transform="translate(69.895982, 116.944107) rotate(-71.000000) translate(-69.895982, -116.944107) "></path>
                <path d="M24.5,109.5 C22.4991751,103.669523 35.0833631,105.49608 62.2525641,114.979669 C79.4278854,120.974828 92.103247,119.378882 106.278649,126.191831 C111.777518,128.834684 120.517968,134.937407 132.5,144.5" id="Line-19" stroke="#FFFFFF" stroke-width="2" opacity="0.595424107" stroke-linecap="square"></path>
                <path d="M169.495543,159.559977 C178.40276,159.559977 199.299282,131.737276 199.299282,97.7482062 C199.299282,85.7856682 202.004463,66.329956 197.824033,53.1018748 C190.126639,28.745108 172.2443,14.8950801 164.051591,32.9277389 C154.185624,54.6433407 160.244191,49.6934798 165.77371,73.3338961 C167.670155,81.4417878 177.014539,100.028618 177.014539,108.708756 C177.014539,142.697825 160.588327,159.559977 169.495543,159.559977 Z" id="Oval-9-Copy-3" fill="#BAC4F6" transform="translate(179.479352, 92.134636) scale(-1, 1) rotate(-43.000000) translate(-179.479352, -92.134636) "></path>
                <path d="M213.5,60.5 C209.183273,60.8948914 201.740861,65.4428024 191.172763,74.1437328 C175.320617,87.1951284 177.797205,83.2393994 161.560337,103.262986 C150.735758,116.612043 142.715646,131.024381 137.5,146.5" id="Line-21" stroke="#FFFFFF" stroke-width="2" stroke-linecap="square"></path>
                <path d="M81.1425752,168.630026 C85.1025169,165.536181 98.2051544,147.96348 98.2051544,111.236918 C98.2051544,74.5103552 86.0176544,46.7369177 70.0176544,46.7369177 C54.0176544,46.7369177 59.5351666,70.3889964 66.8400325,93.0530589 C69.6371249,101.731312 78.9791535,122.814465 81.0032985,132.88325 C84.2653955,149.110029 78.6989273,170.539213 81.1425752,168.630026 Z" id="Oval-10" fill="#E9EDFD" transform="translate(78.936475, 107.743055) rotate(-52.000000) translate(-78.936475, -107.743055) "></path>
                <path d="M39.5,84.5 C46.5402399,84.832105 55.9862242,87.7506309 67.8379528,93.2555776 C85.6155457,101.512998 79.9127462,96.6348296 100.298442,112.739947 C113.888906,123.476691 125.956092,135.063376 136.5,147.5" id="Line-18" stroke="#FFFFFF" stroke-width="2" stroke-linecap="square"></path>
                <path d="M194.823347,177.534556 C197.785465,175.220296 209.085075,165.125173 213.530819,146.109724 C215.496552,137.701844 211.555235,124.000271 211.555235,111.853141 C211.555235,72.2337887 199.639103,43.8487815 182.378853,43.8487815 C165.118604,43.8487815 168.053621,58.2764613 175.933859,82.7256721 C183.814096,107.174883 191.693317,118.61017 193.876895,129.472028 C197.395933,146.976919 192.187224,179.594121 194.823347,177.534556 Z" id="Oval-10-Copy-2" fill="#E9EDFD" transform="translate(191.881132, 110.738214) scale(-1, 1) rotate(-52.000000) translate(-191.881132, -110.738214) "></path>
                <path d="M237.5,84.5 C231.839918,82.6252532 222.387737,84.7837206 209.143456,90.9754021 C189.277034,100.262925 198.344222,96.9653923 174.587666,113.911421 C158.749962,125.208774 147.387407,137.071634 140.5,149.5" id="Line-22" stroke="#FFFFFF" stroke-width="2" opacity="0.785044643" stroke-linecap="square"></path>
                <path d="M102.095097,154.049614 C106.979303,150.233654 123.140143,128.559423 123.140143,83.2607523 C123.140143,37.9620813 108.108037,3.70622602 88.3735811,3.70622602 C68.639125,3.70622602 75.4444439,32.8787829 84.4542911,60.8327171 C87.9042347,71.5365054 99.4267255,97.5405402 101.923313,109.959415 C105.946795,129.97358 99.0810936,156.404412 102.095097,154.049614 Z" id="Oval-10-Copy" fill="#E9EDFD" transform="translate(99.374086, 78.951409) rotate(-21.000000) translate(-99.374086, -78.951409) "></path>
                <path d="M70.5,27.5 C77.9697854,36.2141564 84.664658,44.2949462 90.5846178,51.7423694 C99.4645574,62.9135043 102.309139,65.8595669 108.078018,74.773869 C113.846897,83.6881711 108.232283,69.1486166 118.500716,94.8794382 C125.346337,112.033319 129.012765,128.573507 129.5,144.5" id="Line-16" stroke="#FFFFFF" stroke-width="2" stroke-linecap="square"></path>
                <path d="M193.001521,189.153265 C198.929205,189.153265 212.83568,162.652399 212.83568,130.278124 C212.83568,97.9038493 204.210737,49.7003434 189.378612,68.5372278 C174.540517,87.3816949 180.150684,86.5530431 183.830536,109.070321 C185.092606,116.793013 193.001521,132.403088 193.001521,140.670839 C193.001521,173.045114 187.073837,189.153265 193.001521,189.153265 Z" id="Oval-9-Copy-4" fill="#BAC4F6" transform="translate(196.248002, 126.727326) scale(-1, 1) rotate(-73.000000) translate(-196.248002, -126.727326) "></path>
                <path d="M234.5,116.5 C229.435614,115.997419 220.043174,117.148484 206.322678,119.953197 C185.741934,124.160265 185.201799,123.9696 168.145826,131.063968 C156.775178,135.793546 148.226569,140.93889 142.5,146.5" id="Line-23" stroke="#FFFFFF" stroke-width="2" opacity="0.733426339" stroke-linecap="square"></path>
            </g>
            <g id="Group-4" transform="translate(101.000000, 137.000000)">
                <path d="M0,0 C11.7955729,2 24.5052083,3 38.1289062,3 C51.7526042,3 65.3763021,2 79,0 L71.2109375,75.3409091 C61.9375,77.1136364 51.8945312,78 41.0820312,78 C30.2695313,78 19.4570312,77.1136364 8.64453125,75.3409091 L0,0 Z" id="Rectangle-9" fill="#FCDCCF"></path>
                <path d="M59.2621996,2.19791001 C63.6483775,1.86496527 70.2276443,1.1323286 79,0 L71.2109375,75.3409091 C63.3055851,76.5844933 57.2271178,77.3450382 52.9755357,77.6225437 L59.2621996,2.19791001 Z" id="Rectangle-9" fill="#ECC6B6"></path>
                <path d="M0,0 C10.9588352,1.33333333 23.3572727,2 37.1953125,2 C51.0333523,2 64.9682481,1.33333333 79,0 L76.7909585,21.3672948 L40.573652,23.0934676 L2.38711382,20.8047516 L0,0 Z" id="Rectangle-9" fill="#F3B096"></path>
            </g>
        </g>
    </g>
</g>
</svg>
</div>

</div>
<div class="menuBtn closed"> 
    <div class="menu-line"></div>
    <div class="menu-line"></div>
    <div class="menu-line"></div>
</div>
<div class="nightSky"><!--当关闭夜间背景模式时，子元素将在一段延时后才会被清除--></div>
<div class="main">
    <div class="msg">
        <div class="msgText"></div>
        <div class="msgBar"></div>
    </div>
    <div class="motto">
        <p> //sunny forever<br />
            while(life&lt;end){<br />
               love++;<br />
               beAwesome :)} </p>
     </div>
     <div class="mainContent">
    <div class="canvasWrapper"></div>
<div class="setWrapper">
    <ul class="setMenu">
        <div id="setBtn" class="setButton"><</div>
        <li class="searchContainer">
            <input id="searchInput" class="localSearch" placeholder="搜索..." type="search" >
            <span class="searchIco"></span>
        </li>
        <li id="toggleItem">
        主题：<span class="itemIco sun"></span>
        </li>
        <li class="setSize">
            <span id="increaseFontSize">+</span>
            <span class="fontSizeNum"></span>
            <span id="reduceFontSize">-</span>
        </li>
        <li id="clearBack">清除背景</li>
        <li id="disableBack">禁用背景</li>
    </ul> 
</div>
    <div class="resultContainer">
        <div id="searchResult" class="displayResult"></div>
    </div>
    <div class="tocWrapper"><div class="tocBtn">目 录</div><div class="tocBox"><!--tocBox用于容纳生成在toc外的目录--><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Firewalld"><span class="toc-number">1.</span> <span class="toc-text">Firewalld</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84%E5%8C%BA%E5%9F%9F"><span class="toc-number">1.1.</span> <span class="toc-text">常用的区域</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%B2%E7%81%AB%E5%A2%99%E5%BC%80%E5%90%AF%E4%B8%8E%E5%85%B3%E9%97%AD"><span class="toc-number">1.2.</span> <span class="toc-text">防火墙开启与关闭</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E4%B8%8E%E5%8F%82%E6%95%B0"><span class="toc-number">1.3.</span> <span class="toc-text">命令与参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E6%95%88%E6%A8%A1%E5%BC%8F%EF%BC%8C%E6%9B%B4%E6%96%B0%E9%98%B2%E7%81%AB%E5%A2%99%E8%A7%84%E5%88%99"><span class="toc-number">1.4.</span> <span class="toc-text">生效模式，更新防火墙规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.5.</span> <span class="toc-text">示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91"><span class="toc-number">1.6.</span> <span class="toc-text">端口转发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%8C%E8%A7%84%E5%88%99"><span class="toc-number">1.7.</span> <span class="toc-text">富规则</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPTables"><span class="toc-number">2.</span> <span class="toc-text">IPTables</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%96%E7%95%A5%E4%B8%8E%E8%A7%84%E5%88%99%E9%93%BE"><span class="toc-number">2.1.</span> <span class="toc-text">策略与规则链</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8C%85%E5%88%86%E7%B1%BB%E4%B8%8E%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F"><span class="toc-number">2.2.</span> <span class="toc-text">数据包分类与处理方式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8C%85%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F"><span class="toc-number">2.2.1.</span> <span class="toc-text">数据包处理方式</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E4%B8%8E%E5%8F%82%E6%95%B0-1"><span class="toc-number">2.3.</span> <span class="toc-text">命令与参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%9D%E5%AD%98%E8%A7%84%E5%88%99"><span class="toc-number">2.4.</span> <span class="toc-text">保存规则</span></a></li></ol></li></ol></div></div>
        <div class="article">
        <h1 class="title">Redhat防火墙</h1>
        <div class="art_infor">
            <div><span><span class="iconfont icon-zishu-jzl"></span>字数：7507</span>
            <span><span class="iconfont icon-riqi"></span>写于：2022-02-23</span></div>
            <div><span><span class="iconfont icon-zuixinnew3"></span>最新更新：2022-02-23</span>
            <span><span class="iconfont icon-shijian"></span>阅读本文预计花费您22分钟</span></div>
        </div>
        <div class="art_content">
        <div class="broadcast color-blue">
<div class="iconfont icon-yinhao"></div>
本文不涉及Debian系列操作系统使用的ufw(Uncomplicated FireWall)防火墙</div>

<h3 id="Firewalld"><a href="#Firewalld" class="headerlink" title="Firewalld"></a>Firewalld</h3><p>Firewalld支持动态更新防火墙规则，并加入了区域（zone）的概念，zone是Firewalld预先准备的几套防火墙策略模板，用户可以根据不同生产场景选择合适的策略集合，从而实现防火墙策略之间的快速切换。</p>
<h4 id="常用的区域"><a href="#常用的区域" class="headerlink" title="常用的区域"></a>常用的区域</h4><div class="table">

<table>
<thead>
<tr>
<th>区域</th>
<th>默认策略</th>
</tr>
</thead>
<tbody><tr>
<td>trusted(信任)</td>
<td>允许所有数据包</td>
</tr>
<tr>
<td>block(阻塞)</td>
<td>拒绝所有数据包</td>
</tr>
<tr>
<td>drop(丢弃)</td>
<td>丢弃所有数据包，并且不回复信息</td>
</tr>
<tr>
<td>home(家庭)</td>
<td>仅接受与流出数据有关，或者与ssh、mdns、ipp-client、amba-client与dhcpv6-client服务相关的数据包</td>
</tr>
<tr>
<td>public(公共)</td>
<td>仅接受与流出数据有关，或与ssh、dhcpv6-client服务相关的数据包</td>
</tr>
<tr>
<td>internal(内部)</td>
<td>仅接受与流出数据有关，或与ssh、mdns、ipp-client、dhcpv6-client服务相关的数据包</td>
</tr>
<tr>
<td>work(工作)</td>
<td>仅接受与流出的流量，或与ssh、ipp-client与dhcpv6-client服务相关的数据包</td>
</tr>
<tr>
<td>external(外部)</td>
<td>仅接受与流出流量和ssh服务相关的数据包</td>
</tr>
<tr>
<td>DMZ(隔离)</td>
<td>又称为非军事区域，内外网络之间增加的一层网络，起到缓冲作用，仅接受与流出的流量相关和ssh服务相关的数据包</td>
</tr>
</tbody></table>
</div>

<p>firewalld默认提供了9个zone配置文件：block.xml、dmz.xml、drop.xml、external.xml、 home.xml、internal.xml、public.xml、trusted.xml、work.xml，文件位于<span class="tips">/usr/lib /firewalld/zones/</span>目录下。用户对区域进行修改后，会在<span class="tips">/etc/firewalld/zones</span>目录下生成对应的(用户自定义)配置文件。</p>
<h4 id="防火墙开启与关闭"><a href="#防火墙开启与关闭" class="headerlink" title="防火墙开启与关闭"></a>防火墙开启与关闭</h4><div class="table">

<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>systemctl start firewalld</td>
<td>开启防火墙</td>
</tr>
<tr>
<td>systemctl stop firewalld</td>
<td>关闭防火墙</td>
</tr>
<tr>
<td>systemctl enable firewalld</td>
<td>开机自启动防火墙</td>
</tr>
<tr>
<td>systemctl disable firewalld</td>
<td>禁止开机自启动</td>
</tr>
<tr>
<td>systemctl status firewalld</td>
<td>查看防火墙状态</td>
</tr>
</tbody></table>
</div>


<h4 id="命令与参数"><a href="#命令与参数" class="headerlink" title="命令与参数"></a>命令与参数</h4><p><span class="strong">firewall-cmd [参数]</span></p>
<div class="table">

<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>-&zwnj;-state</td>
<td>查看防火墙是否在运行</td>
</tr>
<tr>
<td>-&zwnj;-get-default-zone</td>
<td>查看当前生效的防火墙区域</td>
</tr>
<tr>
<td>-&zwnj;-set-default-zone=区域名</td>
<td>设置生效的防火墙区域</td>
</tr>
<tr>
<td>-&zwnj;-get-zones</td>
<td>显示所有可用的区域</td>
</tr>
<tr>
<td>-&zwnj;-get-active-zones</td>
<td>显示当前正在使用的区域与网卡名称</td>
</tr>
<tr>
<td>-&zwnj;-zone=区域名 -&zwnj;-list-all</td>
<td>列出指定区域的所有配置参数</td>
</tr>
<tr>
<td>-&zwnj;-list-all-zones</td>
<td>显示所有区域的网卡配置参数、资源、端口以及服务等信息</td>
</tr>
<tr>
<td>-&zwnj;-get-services</td>
<td>查看当前域所有支持的服务(需要放行的服务需要自行添加)</td>
</tr>
<tr>
<td>-&zwnj;-list-services</td>
<td>查看当前区域允许放行的服务列表</td>
</tr>
<tr>
<td>-&zwnj;-add-service=服务名</td>
<td>设置当前区域允许该服务的流量通过</td>
</tr>
<tr>
<td>-&zwnj;-add-port=端口号/协议</td>
<td>设置当前区域允许该端口的流量通过</td>
</tr>
<tr>
<td>-&zwnj;-remove-service=服务名</td>
<td>设置默认区域禁止该服务的流量通过</td>
</tr>
<tr>
<td>-&zwnj;-remove-port=端口号/协议</td>
<td>设置当前区域禁止该端口的流量通过</td>
</tr>
<tr>
<td>-&zwnj;-add-source=</td>
<td>将源自此IP或子网的流量导向指定的区域</td>
</tr>
<tr>
<td>-&zwnj;-remove-source=</td>
<td>不再将源自此IP或子网的流量导向某个指定区域</td>
</tr>
<tr>
<td>-&zwnj;-add-interface=网卡名</td>
<td>将源自该网卡的所有流量都导向某个指定区域</td>
</tr>
<tr>
<td>-&zwnj;-change-interface=网卡名</td>
<td>将某个网卡与区域进行关联</td>
</tr>
<tr>
<td>-&zwnj;-list-all</td>
<td>显示当前区域的网卡、资源配置，以及开放了哪些端口、服务</td>
</tr>
<tr>
<td>-&zwnj;-reload</td>
<td>让“永久生效”的配置规则立即生效，并覆盖当前的配置规则</td>
</tr>
<tr>
<td>-&zwnj;-panic-on</td>
<td>开启应急状况模式(关闭所有网络连接，包括远程ssh连接)</td>
</tr>
<tr>
<td>-&zwnj;-panic-off</td>
<td>关闭应急状况模式</td>
</tr>
</tbody></table>
</div>

<h4 id="生效模式，更新防火墙规则"><a href="#生效模式，更新防火墙规则" class="headerlink" title="生效模式，更新防火墙规则"></a>生效模式，更新防火墙规则</h4><p>默认情况下，firewalld配置的防火墙策略为当前生效模式(Runtime)，系统重启时会失效。想让配置策略永久生效，需要添加<span class="tips">-&zwnj;-permanent</span>参数使用永久模式(Permanent)，如：永久开放10800端口：firewall-cmd -&zwnj;-add-port=10800/tcp -&zwnj;-permanent ，但该模式配置的策略需要执行firewall-cmd -&zwnj;-reload命令重新加载后才会生效。</p>
<div class="table">

<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>firewall-cmd -&zwnj;-reload</td>
<td>重新加载防火墙配置</td>
</tr>
<tr>
<td>firewall-cmd -&zwnj;-complete-reload</td>
<td>重新加载防火墙，不中断用户的连接,如远程连接（防火墙出严重故障时使用）</td>
</tr>
</tbody></table>
</div>

<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><p><strong>1. 查看区域信息</strong></p>
<div class="shell">查看public区域的所有信息
# firewall-cmd --zone=public --list-all
返回值的含义：
Target：default                  //目标
icmp-block-inversion：yes/no    //是否允许ICMP协议类型的数据包通过防火墙
Interfaces：                   //关联的网卡
sources：                     //来源，可以是IP地址或mac地址
services：                   //允许的服务
ports：                     //允许的端口，即本地开放的端口
protocols：                //允许通过的协议
masquerade: yes/no        //是否允许伪装，可改写来源IP地址及mac地址 
forward-ports：          //允许转发的端口 
source-ports：          //允许的来源端口 
icmp-blocks：         //可添加的ICMP类型，当icmp-block-inversion为no时，这些ICMP类型被拒绝；当icmp-block-inversion为yes时，这些ICMP类型被允许
 rich rules： //富规则，即更细致、更详细的防火墙规则策略，它的优先级在所有的防火墙策略中也是最高的。
</div>

<p><strong>2. 放行端口</strong></p>
<div class="shell">永久放行10800-10805端口的tcp数据
# firewall-cmd --permanent --add-port=10800-10805/tcp
重新加载防火墙配置
# firewall-cmd --reload
</div>

<p><strong>3. 为网卡绑定区域</strong></p>
<p>一般情况下，一台主机会有多个网卡，比如一块对公网，一块对内网，因此网卡使用的防火墙策略也不一样，可以单独为某个网卡绑定某个区域。通过firewall-cmd –set-default-zone命令设置的区域会对所有网卡生效，但如果该网卡绑定了单独的区域，则单独绑定区域的优先级更高。</p>
<div class="shell">将网卡eth0默认区域修改为external
# firewall-cmd --permanent --zone=external --change-interface=eth0
</div>

<p><strong>4. 查询服务是否放行</strong></p>
<p>如：查询SSH和HTTPS协议的流量是否允许放行</p>
<div class="shell">查询public区域中SSH协议的流量是否被放行
# firewall-cmd --zone=public --query-service=ssh
查询public区域中https协议的流量是否被放行
# firewall-cmd --zone=public --query-service=https
</div>

<p><strong>5. 放行协议流量</strong></p>
<p>把HTTPS协议的流量设置为永久允许放行</p>
<div class="shell">在public区域中放行https协议的流量
# firewall-cmd --permanent --zone=public --add-service=https
重新加载防火墙配置
# firewall-cmd --reload
</div>


<h4 id="端口转发"><a href="#端口转发" class="headerlink" title="端口转发"></a>端口转发</h4><p>端口转发命令格式如下，目标IP地址为所要访问服务器的IP地址：<br><span class="strong">firewall-cmd –permanent –zone=区域 –add-forward-port=port=源端口号:proto=协议:toport=目标端口号:toaddr=目标IP地址</span></p>
<div class="shell">将9000端口转发到22端口，使得用户能通过9000端口使用ssh远程连接服务
# firewall-cmd --permanent --zone=public --add-forward-port=port=9000:proto=tcp:toport=22:toaddr=192.168.0.1
重新加载防火墙配置
# firewall-cmd --reload
</div>


<h4 id="富规则"><a href="#富规则" class="headerlink" title="富规则"></a>富规则</h4><p>富规则也叫复规则，表示更细致、更详细的防火墙策略配置，它可以针对系统服务、端口号、源地址和目标地址等诸多信息进行更有针对性的策略配置，它的优先级在所有的防火墙策略中也是最高的。</p>
<div class="shell">拒绝192.168.0.1/24网段的所有用户访问本机的ssh服务
# # firewall-cmd --permanent --zone=public --add-rich-rule="rule family="ipv4" source address="192.168.0.1/24" service name="ssh" reject"
重新加载防火墙配置
# firewall-cmd --reload
</div>


<h3 id="IPTables"><a href="#IPTables" class="headerlink" title="IPTables"></a>IPTables</h3><p>早期的RHEL系列的操作系统，默认使用IPTables来配置防火墙。RHEL7之后的系统使用firewalld取代了IPTables防火墙，IPTables服务会把配置好的防火墙策略交由内核层面的netfilter网络过滤器来处理，而firewalld服务则是把配置好的防火墙策略交由内核层面的nftables包过滤框架来处理。</p>
<div class="broadcast color-yellow">
<div class="iconfont icon-dengpao14hao"></div>
Centos官方IPTables文档：<a target="_blank" href="https://wiki.centos.org/HowTos/Network/IPTables">https://wiki.centos.org/HowTos/Network/IPTables</a></div>

<h4 id="策略与规则链"><a href="#策略与规则链" class="headerlink" title="策略与规则链"></a>策略与规则链</h4><p>IPTables会根据管理员书写的策略来决定防火墙是否放行数据包通过，基本的策略规则有四种：ACCEPT、REJECT、LOG、DROP。IPTables会按照从上到下的顺序来读取配置的策略规则，在找到匹配项后立即执行规则定义的行为(如：放行或阻止流量)，若在读取完所有的策略规则之后没有匹配项，则会执行默认的策略。</p>
<p>IPTables服务把用于处理或过滤流量的策略条目称之为规则，多条规则可以组成一个规则链。<span class="tips">由于防火墙策略规则是按照从上到下的顺序匹配执行的，因此一定要把允许规则放到拒绝规则前，否则所有的流量就将被拒绝，因此规则链最后一条往往为拒绝规则。</span></p>
<p>当防火墙的默认策略为拒绝时，需要添加相应的规则链来放行允许进入服务器的数据，否则服务器将拒绝所有数据包；而当防火墙的默认策略为允许时，则需要添加相应的拒绝规则链，否则防火墙就失去了它的作用。一般情况下，INPUT流量的默认策略为拒绝，OUTPUT流量默认策略为允许。</p>
<h4 id="数据包分类与处理方式"><a href="#数据包分类与处理方式" class="headerlink" title="数据包分类与处理方式"></a>数据包分类与处理方式</h4><p>根据数据包的不同处理位置，数据包分为</p>
<ul>
<li><span class="strong">在进行路由选择前处理数据包(PREROUTING)</strong></li>
<li><span class="strong">处理流入的数据包(INPUT)</strong></li>
<li><span class="strong">处理流出的数据包(OUTPUT)</strong></li>
<li><span class="strong">处理转发的数据包(FORWARD)</strong></li>
<li><span class="strong">在进行路由选择后处理数据包(POSTROUTING)</strong></li>
</ul>
<h5 id="数据包处理方式"><a href="#数据包处理方式" class="headerlink" title="数据包处理方式"></a>数据包处理方式</h5><div class="table">

<table>
<thead>
<tr>
<th>语句</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>ACCEPT</td>
<td>允许流量通过</td>
</tr>
<tr>
<td>REJECT</td>
<td>拒绝流量通过并返回流量被丢弃的提示信息</td>
</tr>
<tr>
<td>LOG</td>
<td>记录日志信息</td>
</tr>
<tr>
<td>DROP</td>
<td>拒绝流量通过且不返回任何信息</td>
</tr>
</tbody></table>
</div>

<p>REJECT会在拒绝流量后，告知流量发送方流量已收到，但服务器拒绝响应的信息</p>
<p>DROP会直接丢弃流量，使流量发送方不清楚流量是被拒绝还是主机不在线，一般能更好保护主机安全。</p>
<h4 id="命令与参数-1"><a href="#命令与参数-1" class="headerlink" title="命令与参数"></a>命令与参数</h4><p><span class="strong">iptables [参数] [对象]</span></p>
<div class="table">

<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>-L</td>
<td>查看当前的规则链，可以使用iptables -L –line-numbers命令显示规则链的序号</td>
</tr>
<tr>
<td>-P</td>
<td>设置默认策略</td>
</tr>
<tr>
<td>-F</td>
<td>清空规则链</td>
</tr>
<tr>
<td>-A</td>
<td>在规则链末尾加入新规则</td>
</tr>
<tr>
<td>-I [序号]</td>
<td>在指定序号规则前加入新规则，无序号默认在规则链首加入</td>
</tr>
<tr>
<td>-R 序号</td>
<td>替换指定规则，无序号默认替换第一条规则</td>
</tr>
<tr>
<td>-D 序号</td>
<td>删除指定规则</td>
</tr>
<tr>
<td>-s IP/主机名</td>
<td>匹配来源的IP和主机，加!号表示除该IP外，子网掩码可以使用/MASK的方式表示</td>
</tr>
<tr>
<td>-d</td>
<td>匹配目标地址，类似于参数-s</td>
</tr>
<tr>
<td>-J</td>
<td>跳转到下一个处理规则，可能的值有：ACCEPT(允许数据通过), DROP(丢弃), QUEUE(进入队列), RETURN(返回上一个跳转规则)。也可以添加规则名跳转到指定规则</td>
</tr>
<tr>
<td>-i 网卡名</td>
<td>匹配从该网卡流入的数据</td>
</tr>
<tr>
<td>-o 网卡名</td>
<td>匹配从该网卡流出的数据</td>
</tr>
<tr>
<td>-p 协议</td>
<td>匹配协议，如:TCP、UDP等,all代表所有协议(一般不使用)</td>
</tr>
<tr>
<td>-&zwnj;-dport 端口号</td>
<td>匹配目标端口号</td>
</tr>
<tr>
<td>-&zwnj;-sport 端口号</td>
<td>匹配来源端口号</td>
</tr>
</tbody></table>
</div>
<div class="broadcast color-red">
<div class="iconfont icon-gantanhao"></div>
防火墙命令均需要root权限</div>
<div class="shell">如：查看当前规则链
iptables -L
返回结果：
Chain INPUT (policy ACCEPT)     //INPUT数据包，默认策略为ACCEPT
num  target     prot opt source               destination         
1    ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED
2    ACCEPT     all  --  anywhere             anywhere            
3    INPUT_direct  all  --  anywhere             anywhere            
4    INPUT_ZONES_SOURCE  all  --  anywhere             anywhere            
5    INPUT_ZONES  all  --  anywhere             anywhere            
6    DROP       all  --  anywhere             anywhere             ctstate INVALID
7    REJECT     all  --  anywhere             anywhere             reject-with icmp-host-prohibited
</div>
<div class="show">示例：
<strong>1. 修改INPUT规则链默认配置为拒绝，并允许允许ICMP流量进入(允许服务器被ping后返回信息)</strong>
# iptables -P INPUT DROP
# iptables -I INPUT -p icmp -j ACCEPT
<strong>2. 拒绝所有人访问本机10800端口</strong>
# iptables -I INPUT -p tcp --dport 10800 -j REJECT
# iptables -I INPUT -p udp --dport 10800 -j REJECT
<strong>3. 拒绝192.168.10.5主机访问本机80端口</strong>
iptables -I INPUT -p tcp -s 192.168.10.5 --dport 80 -j REJECT
<strong>4.拒绝所有主机访问本机1000～1024端口</strong>
# iptables -A INPUT -p tcp --dport 1000:1024 -j REJECT
# iptables -A INPUT -p udp --dport 1000:1024 -j REJECT
<strong>5.只允许192.168.10.0主机访问本机的22端口，拒绝来自其他所有主机的流量。</strong>
# iptables -I INPUT -s 192.168.10.0 -p tcp --dport 22 -j ACCEPT
# iptables -A INPUT -p tcp --dport 22 -j REJECT
</div>
<div class="broadcast color-purple">
<div class="iconfont icon-fengche"></div>
如同第5条命令，由于防火墙策略规则是按照从上到下的顺序匹配的，因此需要把允许规则放到拒绝规则前，否则所有的流量就将被拒绝</div>
<div class="show">
网口转发,如将公网的数据包转发到内网,假设eth0连接内网，eth1连接公网
iptables -A FORWARD -i eth0 -o eth1 -j ACCEPT
</div>



<h4 id="保存规则"><a href="#保存规则" class="headerlink" title="保存规则"></a>保存规则</h4><p>通过命令添加的规则链，会在系统重启后失效，因此需要写入配置文件使其永久生效，可以使用命令<span class="tips">service iptables save</span>保存</p>
<p>ipv4默认保存位置为<span 
class="tips">/etc/sysconfig/iptables-config</span></p>
<p>ipv6默认保存位置为<span class="tips">/etc/sysconfig/ip6tables-config</span></p>

        </div>
    </div>
    <div class="post-nav">
        
            <div class="post-prev ">
                <a href="/blog/2022/03/04/nginx%E7%AC%94%E8%AE%B0/">上一篇：Nginx笔记(上)</a>
            </div>
            
            
                <div class="post-next">
                    <a href="/blog/2022/02/10/Bash%E4%B8%8Eshell/">下一篇：Bash与shell脚本 </a>
                </div>
                 
    </div>
    <div class="container">
        <!--设计来源于B站-季夏小贞-->
        <div class="bigHead"></div>
        <div class="ears"></div>
        <div class="body"></div>
        <div class="paws-front"></div>
        <div class="paws-back"></div>
        <div class="details"></div>
        <div class="tail"></div>
        <div class="sleep">
          <span class="s1">z</span>
          <span class="s2">z</span>
          <span class="s3">z</span>
          <span class="s4">z</span>
          <span class="s5">z</span>
        </div>
    </div>
</div>
<div class="right-menu">
    <a class="iconfont backTop" href="javascript:">&#xe655;</a>
    <div class="husky"></div>
  </div>
</div>

<script src="/blog/js/jquery.min.js"></script>
<script src="/blog/js/jquery.bumpytext.js"></script>
<script src="/blog/js/index.js"></script>
<script src="/blog/js/highlight.min.js"></script>
<script src="/blog/js/highlightjs-line-numbers.min.js"></script>
<script src="/blog/js/article.js"></script>

</body></html>